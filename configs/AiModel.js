/*
 * Install the Generative AI SDK
 *
 * $ npm install @google/generative-ai
 *
 * See the getting started guide for more information
 * https://ai.google.dev/gemini-api/docs/get-started/node
 */

const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = process.env.EXPO_PUBLIC_GOOGLE_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-1.5-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  // safetySettings: Adjust safety settings
  // See https://ai.google.dev/gemini-api/docs/safety-settings
  history: [
    {
      role: "user",
      parts: [
        {
          text: "Moderate budget with a Flight details, Flight Price with Booking url, Hotels options list with HotelName, Hotel address, Price, hotel image url, geo coordinates, rating, descriptions and Places to visit nearby with placeName, Place Details, Place Image url, Geo Coordinates, ticket Pricing, Time to travel each of the location for 3 days and 2 night with each day plan with best time to visit in JSON format.\n",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "trip": {\n    "destination": "Paris, France",\n    "duration": "3 days, 2 nights",\n    "budget": "Moderate",\n    "flight": {\n      "details": "Round trip from New York City (JFK) to Paris (CDG) with a layover in Amsterdam.",\n      "price": "$650",\n      "booking_url": "https://www.google.com/flights"\n    },\n    "hotels": [\n      {\n        "name": "Hôtel de France",\n        "address": "3 Rue de France, 75009 Paris, France",\n        "price": "$150/night",\n        "image_url": "https://www.example.com/hotel-de-france.jpg",\n        "geo_coordinates": [48.8745, 2.3502],\n        "rating": 4.5,\n        "description": "Charming hotel in a central location, close to the Louvre Museum and the Tuileries Garden."\n      },\n      {\n        "name": "Hôtel du Nord",\n        "address": "102 Rue du Faubourg du Temple, 75010 Paris, France",\n        "price": "$120/night",\n        "image_url": "https://www.example.com/hotel-du-nord.jpg",\n        "geo_coordinates": [48.8718, 2.3647],\n        "rating": 4,\n        "description": "Modern hotel with a stylish design and a rooftop bar, offering panoramic views of the city."\n      }\n    ],\n    "places_to_visit": [\n      {\n        "name": "Eiffel Tower",\n        "details": "Iconic wrought-iron lattice tower on the Champ de Mars, offering stunning views of the city.",\n        "image_url": "https://www.example.com/eiffel-tower.jpg",\n        "geo_coordinates": [48.8584, 2.2945],\n        "ticket_pricing": "$26.50",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Louvre Museum",\n        "details": "World-renowned art museum housing masterpieces like the Mona Lisa and Venus de Milo.",\n        "image_url": "https://www.example.com/louvre-museum.jpg",\n        "geo_coordinates": [48.8606, 2.3376],\n        "ticket_pricing": "$17",\n        "time_to_travel": "2 hours"\n      },\n      {\n        "name": "Arc de Triomphe",\n        "details": "Triumphal arch honoring French military victories, offering views of the Champs-Élysées.",\n        "image_url": "https://www.example.com/arc-de-triomphe.jpg",\n        "geo_coordinates": [48.8738, 2.2950],\n        "ticket_pricing": "$13",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Notre Dame Cathedral",\n        "details": "Historic Catholic cathedral known for its Gothic architecture and stained-glass windows.",\n        "image_url": "https://www.example.com/notre-dame-cathedral.jpg",\n        "geo_coordinates": [48.8534, 2.3488],\n        "ticket_pricing": "Free",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Sacré-Cœur Basilica",\n        "details": "Roman Catholic basilica perched on the hill of Montmartre, offering breathtaking views of Paris.",\n        "image_url": "https://www.example.com/sacré-cœur-basilica.jpg",\n        "geo_coordinates": [48.8892, 2.3419],\n        "ticket_pricing": "Free",\n        "time_to_travel": "2 hours"\n      }\n    ],\n    "daily_plan": [\n      {\n        "day": "Day 1",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Visit the Eiffel Tower",\n            "notes": "Take the elevator or stairs to the top for panoramic views. Remember to buy your tickets online in advance."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Explore the Louvre Museum",\n            "notes": "Start with the Mona Lisa, then wander through the vast collection of art and artifacts."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Dinner and drinks at a cafe in Montmartre",\n            "notes": "Enjoy a delicious meal and watch the sunset over Paris."\n          }\n        ]\n      },\n      {\n        "day": "Day 2",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Stroll along the Champs-Élysées",\n            "notes": "Shop for souvenirs, admire the architecture, and take in the bustling atmosphere."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Visit the Arc de Triomphe",\n            "notes": "Take the elevator to the top for breathtaking views of the city."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Attend a performance at the Palais Garnier",\n            "notes": "Enjoy a spectacular opera or ballet performance."\n          }\n        ]\n      },\n      {\n        "day": "Day 3",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Explore Notre Dame Cathedral",\n            "notes": "Admire the Gothic architecture and stained-glass windows."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Visit the Sacré-Cœur Basilica",\n            "notes": "Take in the breathtaking views from the top of the hill."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Enjoy a farewell dinner at a restaurant in the Latin Quarter",\n            "notes": "Savor a delicious French meal before heading back to your hotel."\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Explanation of the JSON structure:**\n\n* **trip:** This is the top-level object containing information about the trip.\n    * **destination:** The destination city, Paris, France.\n    * **duration:** The length of the trip, 3 days and 2 nights.\n    * **budget:** The budget level, set to "Moderate".\n    * **flight:** Information about the flight:\n        * **details:** A brief description of the flight route.\n        * **price:** The estimated flight price.\n        * **booking_url:** A URL for booking the flight (placeholder, replace with actual booking site).\n    * **hotels:** A list of hotel options:\n        * **name:** The name of the hotel.\n        * **address:** The address of the hotel.\n        * **price:** The approximate price per night.\n        * **image_url:** A URL for an image of the hotel (placeholder, replace with actual images).\n        * **geo_coordinates:** The latitude and longitude coordinates of the hotel.\n        * **rating:** The average star rating of the hotel.\n        * **description:** A brief description of the hotel.\n    * **places_to_visit:** A list of places to visit in Paris:\n        * **name:** The name of the place.\n        * **details:** A brief description of the place.\n        * **image_url:** A URL for an image of the place (placeholder, replace with actual images).\n        * **geo_coordinates:** The latitude and longitude coordinates of the place.\n        * **ticket_pricing:** The price of entry tickets (if applicable).\n        * **time_to_travel:** An estimate of the time needed to explore the place.\n    * **daily_plan:** A list of daily schedules:\n        * **day:** The day number of the trip.\n        * **schedule:** A list of activities for each day:\n            * **time:** The time range for the activity.\n            * **activity:** The name of the activity.\n            * **notes:** Additional information or tips for the activity.\n\n**Important Notes:**\n\n* Replace the placeholder URLs with actual URLs for the images, booking websites, etc.\n* This is a sample JSON structure and can be customized based on your specific requirements.\n* You can add more places to visit, hotels, and details to the schedule as needed.\n* The budget level and price estimates are approximate, and actual prices may vary depending on the season, availability, and specific choices.\n* It\'s recommended to do your research and book flights, hotels, and tickets in advance to secure the best deals. \n',
        },
      ],
    },
    {
      role: "user",
      parts: [{ text: "you missed flight details\n" }],
    },
    {
      role: "model",
      parts: [
        {
          text: 'You are absolutely right! I apologize for missing the flight details in the previous response. Here is the updated JSON with more specific flight information: \n\n```json\n{\n  "trip": {\n    "destination": "Paris, France",\n    "duration": "3 days, 2 nights",\n    "budget": "Moderate",\n    "flight": {\n      "details": "Round trip flight from New York City (JFK) to Paris (CDG) with a layover in Amsterdam.",\n      "airline": "KLM Royal Dutch Airlines",\n      "flight_number": "KL643",\n      "departure_date": "2024-03-15",\n      "departure_time": "10:00 AM",\n      "arrival_date": "2024-03-15",\n      "arrival_time": "4:00 PM",\n      "return_date": "2024-03-18",\n      "return_time": "9:00 AM",\n      "price": "$650",\n      "booking_url": "https://www.google.com/flights" \n    },\n    "hotels": [\n      {\n        "name": "Hôtel de France",\n        "address": "3 Rue de France, 75009 Paris, France",\n        "price": "$150/night",\n        "image_url": "https://www.example.com/hotel-de-france.jpg",\n        "geo_coordinates": [48.8745, 2.3502],\n        "rating": 4.5,\n        "description": "Charming hotel in a central location, close to the Louvre Museum and the Tuileries Garden."\n      },\n      {\n        "name": "Hôtel du Nord",\n        "address": "102 Rue du Faubourg du Temple, 75010 Paris, France",\n        "price": "$120/night",\n        "image_url": "https://www.example.com/hotel-du-nord.jpg",\n        "geo_coordinates": [48.8718, 2.3647],\n        "rating": 4,\n        "description": "Modern hotel with a stylish design and a rooftop bar, offering panoramic views of the city."\n      }\n    ],\n    "places_to_visit": [\n      {\n        "name": "Eiffel Tower",\n        "details": "Iconic wrought-iron lattice tower on the Champ de Mars, offering stunning views of the city.",\n        "image_url": "https://www.example.com/eiffel-tower.jpg",\n        "geo_coordinates": [48.8584, 2.2945],\n        "ticket_pricing": "$26.50",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Louvre Museum",\n        "details": "World-renowned art museum housing masterpieces like the Mona Lisa and Venus de Milo.",\n        "image_url": "https://www.example.com/louvre-museum.jpg",\n        "geo_coordinates": [48.8606, 2.3376],\n        "ticket_pricing": "$17",\n        "time_to_travel": "2 hours"\n      },\n      {\n        "name": "Arc de Triomphe",\n        "details": "Triumphal arch honoring French military victories, offering views of the Champs-Élysées.",\n        "image_url": "https://www.example.com/arc-de-triomphe.jpg",\n        "geo_coordinates": [48.8738, 2.2950],\n        "ticket_pricing": "$13",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Notre Dame Cathedral",\n        "details": "Historic Catholic cathedral known for its Gothic architecture and stained-glass windows.",\n        "image_url": "https://www.example.com/notre-dame-cathedral.jpg",\n        "geo_coordinates": [48.8534, 2.3488],\n        "ticket_pricing": "Free",\n        "time_to_travel": "1 hour"\n      },\n      {\n        "name": "Sacré-Cœur Basilica",\n        "details": "Roman Catholic basilica perched on the hill of Montmartre, offering breathtaking views of Paris.",\n        "image_url": "https://www.example.com/sacré-cœur-basilica.jpg",\n        "geo_coordinates": [48.8892, 2.3419],\n        "ticket_pricing": "Free",\n        "time_to_travel": "2 hours"\n      }\n    ],\n    "daily_plan": [\n      {\n        "day": "Day 1",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Visit the Eiffel Tower",\n            "notes": "Take the elevator or stairs to the top for panoramic views. Remember to buy your tickets online in advance."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Explore the Louvre Museum",\n            "notes": "Start with the Mona Lisa, then wander through the vast collection of art and artifacts."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Dinner and drinks at a cafe in Montmartre",\n            "notes": "Enjoy a delicious meal and watch the sunset over Paris."\n          }\n        ]\n      },\n      {\n        "day": "Day 2",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Stroll along the Champs-Élysées",\n            "notes": "Shop for souvenirs, admire the architecture, and take in the bustling atmosphere."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Visit the Arc de Triomphe",\n            "notes": "Take the elevator to the top for breathtaking views of the city."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Attend a performance at the Palais Garnier",\n            "notes": "Enjoy a spectacular opera or ballet performance."\n          }\n        ]\n      },\n      {\n        "day": "Day 3",\n        "schedule": [\n          {\n            "time": "Morning (9:00 AM - 12:00 PM)",\n            "activity": "Explore Notre Dame Cathedral",\n            "notes": "Admire the Gothic architecture and stained-glass windows."\n          },\n          {\n            "time": "Afternoon (1:00 PM - 4:00 PM)",\n            "activity": "Visit the Sacré-Cœur Basilica",\n            "notes": "Take in the breathtaking views from the top of the hill."\n          },\n          {\n            "time": "Evening (6:00 PM - 8:00 PM)",\n            "activity": "Enjoy a farewell dinner at a restaurant in the Latin Quarter",\n            "notes": "Savor a delicious French meal before heading back to your hotel."\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Flight Details:**\n\n* **details:** "Round trip flight from New York City (JFK) to Paris (CDG) with a layover in Amsterdam."\n* **airline:** "KLM Royal Dutch Airlines"\n* **flight_number:** "KL643"\n* **departure_date:** "2024-03-15" (This is an example date, replace with your desired date)\n* **departure_time:** "10:00 AM" \n* **arrival_date:** "2024-03-15"\n* **arrival_time:** "4:00 PM"\n* **return_date:** "2024-03-18"\n* **return_time:** "9:00 AM"\n* **price:** "$650"\n* **booking_url:** "https://www.google.com/flights" \n\nI\'ve added specific details to the flight object, making the information more complete and helpful. Remember to change the placeholder dates to your actual travel dates! \n',
        },
      ],
    },
  ],
});

// const result = await chatSession.sendMessage("INSERT_INPUT_HERE");
// console.log(result.response.text());
